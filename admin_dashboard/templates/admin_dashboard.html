{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Academeet</title>
    <link rel="stylesheet" href="{% static 'admin_dashboard.css' %}">
</head>
<body>

<header class="navbar">
  <div class="logo-section">
    <div class="logo-icon">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/><path d="M9 12l2 2 4-4"/></svg>
    </div>
    <h1>Academeet</h1>
  </div>
    <div class="nav-right">
       <div class="user-section">
            <div class="profile-icon">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            </div>
            <span class="user-name">{{ user.username }}</span>
            <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
        </div>
    </div>
</header>

<main class="dashboard">
    <div class="dashboard-left">
        <div class="calendar-section">
            <h3 class="calendar-title">Calendar</h3>
            <div class="calendar-container">
                <div class="calendar-header">
                    <button id="prevMonth">◀</button>
                    <span id="monthYear">November 2025</span>
                    <button id="nextMonth">▶</button>
                </div>
                <table class="month-calendar">
                    <thead>
                        <tr>
                            <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th>
                            <th>Thu</th><th>Fri</th><th>Sat</th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="dashboard-right">
        <h2>Admin Dashboard</h2>
        <p>Welcome, {{ request.user.username }}</p>

        <div class="filter-section">
            <button class="filter-tab active" data-filter="all">All</button>
            <button class="filter-tab" data-filter="active">Active</button>
            <button class="filter-tab" data-filter="deactivated">Deactivated</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    {% for user in users %}
                    <tr class="user-row {% if user.is_active %}active-user{% else %}deactivated-user{% endif %}">
                        <td>{{ user.id }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.role|default:"—" }}</td>
                        <td class="status-{% if user.is_active %}active{% else %}deactivated{% endif %}">
                            {{ user.is_active|yesno:"Active,Deactivated" }}
                        </td>
                        <td>
                            <form method="post" action="{% url 'toggle_user_status' user.id %}">
                                {% csrf_token %}
                                {% if user.is_active %}
                                    <button type="submit" class="action-btn deactivate">Deactivate</button>
                                {% else %}
                                    <button type="submit" class="action-btn activate">Activate</button>
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filterTabs = document.querySelectorAll('.filter-tab');
        const userRows = document.querySelectorAll('.user-row');

        function filterUsers(filterStatus) {
            userRows.forEach(row => {
                // Check if the row has the class corresponding to the filterStatus
                const matchesFilter = row.classList.contains(filterStatus + '-user');

                if (filterStatus === 'all') {
                    row.style.display = ''; // Show all rows
                } else if (matchesFilter) {
                    row.style.display = ''; // Show matching rows
                } else {
                    row.style.display = 'none'; // Hide non-matching rows
                }
            });
        }

        filterTabs.forEach(button => {
            button.addEventListener('click', function() {
                const filterStatus = this.getAttribute('data-filter');

                // 1. Update active button styling
                filterTabs.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // 2. Run the filtering logic
                filterUsers(filterStatus);
            });
        });

        // Initial filter on page load (starts with 'All' selected)
        filterUsers('all'); 
    });
</script>

<script src="{% static 'core/js/calendar.js' %}"></script>
</body>
</html>